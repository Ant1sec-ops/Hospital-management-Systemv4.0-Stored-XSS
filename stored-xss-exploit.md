
#  Stored Cross-Site Scripting (XSS)

##  Stored XSS Vulnerability in Hospital Management System v4.0

---

###  Vulnerability Summary

A critical **Stored Cross-Site Scripting (XSS)** vulnerability was discovered in the  
[`edit-patient.php`](http://192.168.137.97/hospital/hms/doctor/edit-patient.php) file of PHPGurukul's Hospital Management System (v4.0).  
Attackers can inject malicious JavaScript via the `patname` field (POST parameter), which gets **persistently stored** in the database and executed whenever the profile page is viewed.

---

### Key Details

| Property            | Value                                                          |
|---------------------|----------------------------------------------------------------|
| Affected Vendor     | PHPGurukul                                                     |
| Vulnerable File     | `edit-patient.php`                                                  |
| Attack Vector       | `patname` parameter via POST request                              |
| Vulnerability Type  | Stored Cross-Site Scripting (XSS)                              |
| Version Affected    | v4.0                                                           |
| Official Website    | [Hospital Management System](https://phpgurukul.com/hospital-management-system-in-php/)        |

---

##  Proof of Concept (PoC)

### Step-by-Step Exploitation

1. **Login to the Hostpital management system**
    - Navigate to the login portal and authenticate using valid credentials.

    http://192.168.137.97/hospital/hms/doctor/

    ![Login Page](https://github.com/Ant1sec-ops/Hospital-management-Systemv4.0-Stored-XSS/blob/main/1.png)

2. **Inject XSS Payload in Name Field**

Navigate to patient management dahhboard (left hand side):

- Go to `Patients (select any patient) â†’ edit`.
  

http://192.168.137.97/hospital/hms/doctor/manage-patient.php

Paste the following payload in the "patient name" input field and click **Update**:  
Payload:

```html
exz81<script>alert(1)</script>x8xsf
```

http://192.168.137.97/hospital/hms/doctor/edit-patient.php?editid=2
![Patient Management Page](https://github.com/Ant1sec-ops/Hospital-management-Systemv4.0-Stored-XSS/blob/main/3.png)

3. **Trigger the Payload**

Reload the profile page. Youâ€™ll see a JavaScript `alert(1)` triggered â€” confirming the stored XSS vulnerability. Also clickling on view profile will load new windows with alert pop up confirming the xss vulnerability.

![Patient Management Page](https://github.com/Ant1sec-ops/Hospital-management-Systemv4.0-Stored-XSS/blob/main/4.png)

New window with alert pop up:

![Patient Management Page](https://github.com/Ant1sec-ops/Hospital-management-Systemv4.0-Stored-XSS/blob/main/5.png)

---

## Potential Impact

- **Session Hijacking**: Steal user/admin session cookies via `document.cookie`.
- **Phishing**: Inject fake forms to harvest credentials.
- **Defacement**: Alter webpage content, defame the brand.
- **Data Exfiltration**: Steal sensitive data through background requests.
- **Malware Propagation**: Redirect users to malicious domains.
- **Privilege Escalation**: Gain access to higher-privilege accounts by exploiting stored scripts.

---

##  Mitigation Strategies

### Input Sanitization

Sanitize all user inputs on the server side using functions like `htmlspecialchars()` in PHP.

### Output Encoding

Encode output before rendering dynamic content:

```php
echo htmlentities($user_input, ENT_QUOTES, 'UTF-8');
```

### Content Security Policy (CSP)

Implement a strict CSP header to prevent inline script execution:

```http
Content-Security-Policy: default-src 'self'; script-src 'self';
```

### Use Modern Frameworks

PHP frameworks like Laravel, Symfony, or CodeIgniter offer built-in XSS protection.

### Security Testing

Perform regular pentests using tools like OWASP ZAP or Burp Suite to detect XSS vectors.

---

##  References and Resources

- ðŸ”— [OWASP XSS Prevention Cheat Sheet](https://cheatsheetseries.owasp.org/cheatsheets/Cross_Site_Scripting_Prevention_Cheat_Sheet.html)
- ðŸ”— [Content Security Policy (CSP) Guide - MDN](https://developer.mozilla.org/en-US/docs/Web/HTTP/CSP)
- ðŸ”— [PHP htmlspecialchars()](https://www.php.net/manual/en/function.htmlspecialchars.php)
- ðŸ”— [PHPGurukul Small CRM](https://phpgurukul.com/small-crm-php/)
- ðŸ”— [OWASP Secure Coding Practices](https://owasp.org/www-project-secure-coding-practices-quick-reference-guide/)

---

> **Author**: *Subhash Paudel*  
> **Date**: 2025-06-02  
> **Severity**: High  
